# Task
ID.AM-1.1: Perform Vulnerability scan of network

## Conditions
Given a IP Address range and local administrator credentials, an incident response workstation, network access, and a vulnerability assessment tool. Perform a Vulnerability scan of a network
## Standards
1. Team member verifies network connectivity to a network
2. Team member assures the vulnerability assessment tool is using the latest updates and signatures of the selected tool
3. Team member scans a network and identifies all hosts / systems on network enclave
4. Team member configures the vulnerability assessment tool with the IP address of the network enclave
5. Team member selects assessment options within the tool based on testing level required (Note: Some tests can cause denial of service to host and will need to be evaluated before beginning of assessment)
6. Team member runs the assessment with selected options and monitors progress
7. Team member evaluates the results of the assessment and determines if critical or high vulnerabilities exist on the test machine.
## End State
All hosts and devices on a network are identified and documented
All vulnerabilities on the test machine are found and critical or high results are evaluated for remediation
## Notes
There are several free and commercial tools available to assist with this task on Linux hosts. OpenVAS is the Open Source version of Nessus and both can be used to perform this task depending on availability.

As noted in the Standards section, care must be given to the assessment options as some can cause denial of service conditions on the tested host which will cause the remainder of the test to fail. These conditions are normally annotated in the toolâ€™s documentation.
## Manual Steps

### Determine if the client/victim currently have designated in-house vulnerability tools
1. Identify if the customer has a service account to conduct your scans. [See ID.GV-3.1 Establish Network Access Accounts](https://github.com/cybersurfers/Battle-Drills/tree/master/ID.GV-3.1-IDENTIFY_GV_3_1_Establish_network_access_accounts)
2. Request a network topolgy from the network owner(if available)
   - Verify network topology with a ping sweep 
3. Establish and separate vulnerability scan groups by Operating Systems(Win/Linux)
   - Narrow vulnerability scans prevent false results
4. Verify the credentials you are using to scan have:
   - `Sudo` privilege for Unix/Linux
   - `Administrator group` for Windows

(Optional) Update your machine and system packages:
```
1. sudo apt-get update
2. sudo apt-get dist-upgrade
```

### Installing OpenVAS
Install OpenVAS with the following commands
NOTE: the setup command will create an admin account, make sure to copy and save the password. 
```
1. sudo apt-get install openvas
2. sudo openvas-setup
3. sudo openvas-start
```

To change the admin username and password complete the following command as root
```
root@kali:~#openvasmd --user=admin --new-password=password
```

### Verify all signatures and feeds are up-to-date
To access OpenVAS web front-end open a browser and navigate to https://server_name_or_IP:9392

1. Hover over Extras
2. Click on Feed Status
3. Verify NVTs version is on or about the current date

The formation of the timestamp is: YYYYMMDDHHSS

You can update all feeds from the terminal
```
root@kali:~# openvas-nvt-sync
```

### Perform Device Discovery Scan
1. Access OpenVAS web front-end
2. Navigate to Scans -> Tasks
3. Start the Advanced Wizard by hovering over the purple New Wizard Icon in top left
4. Enter the following fields
a. Task Name
b. Scan Config: Discovery
c. Target Hosts
d. Start Time
5. To view reports navigate to Scans -> Reports

### Perform a Simple Scan
1. Access OpenVAS web front-end
2. Start the Task Wizard by hovering over the purple New Wizard Icon in top left
3. Enter the IP address range and click "Start Scan"
4. To view reports navigate to Scans -> Reports

### Perform an Authenticated / Credentialed Scan
1. Access OpenVAS web front-end
2. Navigate to Configuration -> Credentials
3. In the top left select New Credential
4. Create the new credentials after filling in the information
5. Navigate to Scans -> Tasks
6. Start the Advanced Wizard by hovering over the purple New Wizard Icon in top left
7. Enter the following information
a. Task Name
b. Change Scan Config to "Full and Fast"
c. Enter IP address or CIDR address range for Target Hosts
d. Select the appropriate credentials created above
e. Click Create Task to start your scan
8. To view reports navigate to Scans -> Reports

NOTE#1: To perform Credentialed / Authenticated scans on windows hosts you must: 
1. Ensure remote registry service is started
2. The credentials used must be members of the Local or Domain administrator group on scanned hosts
3. The File and Printer Sharing is activated - if hosts are Windows XP do not use Simple File Sharing

NOTE#2
If you receive an error while creating user credentials verify that the following directory exists:
```
/var/lib/openvas/gnupg
```
If the above directory does not exist create it by typing on the server as root
```
root@kali:~# mkdir /var/lib/openvas/gnupg
```

### Report and Remediate All High, Medium, and Low Findings
NOTE: Implementing remediations requires approval from multiple sources. Please contact your leadership to ensure the proper documentation has been completed and personnel have agreed upon the changes prior to implementing and changes to a network. Major changes to a network should be tested prior to a full implementation accross the network.
1. Navigate to Scans -> Reports
2. Select the report you wish to review
3. Vulnerabilities will be listed in order of severity
4. Click on each vulnerability and review/implement suggested remediation and workarounds per local SOP

## Running Scripts
No script; this is a manual process

## Dependencies
Internet Connection

OpenVAS

Nessus

## References
1. www.openvas.org
2. www.tenable.com/nessus

## Revision History
24 June 2020
